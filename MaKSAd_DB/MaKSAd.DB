DROP DATABASE IF EXISTS maksad;
CREATE DATABASE maksad CHARACTER SET utf8mb4;
USE maksad;

CREATE TABLE maksad_users (
    user_id        INT AUTO_INCREMENT PRIMARY KEY,
    full_name      VARCHAR(150) NOT NULL,
    email          VARCHAR(150) NOT NULL UNIQUE,
    phone          VARCHAR(30),
    password       VARCHAR(255) NOT NULL,
    gender         VARCHAR(10),
    date_of_birth  DATE,
    preferred_type VARCHAR(50),
    interests      JSON,       -- stored as JSON array
    skills         JSON,       -- stored as JSON array
    role           VARCHAR(50) NOT NULL  -- Admin / Organizer / Volunteer
);


-- ===================== ADMINS =====================
DROP TABLE IF EXISTS admins;
CREATE TABLE admins (
    admin_id       INT AUTO_INCREMENT PRIMARY KEY,
    name           VARCHAR(100) NOT NULL,
    email          VARCHAR(100) NOT NULL UNIQUE,
    password       VARCHAR(255) NOT NULL,
    is_super_admin TINYINT(1) NOT NULL DEFAULT 0,
    role_title     VARCHAR(100),
    last_login     DATETIME
);

-- ===================== ORGANIZERS =====================
DROP TABLE IF EXISTS organizers;
CREATE TABLE organizers (
    organizer_id INT AUTO_INCREMENT PRIMARY KEY,
    name         VARCHAR(100) NOT NULL,
    email        VARCHAR(100) NOT NULL,
    phone        VARCHAR(30),
    active       TINYINT(1) NOT NULL DEFAULT 1,
    description   TEXT
);

-- ===================== VOLUNTEERS =====================
DROP TABLE IF EXISTS volunteers;
CREATE TABLE volunteers (
    volunteer_id   INT AUTO_INCREMENT PRIMARY KEY,
    volunteer_name VARCHAR(100) NOT NULL,
    total_hours    DOUBLE NOT NULL DEFAULT 0
);

-- ===================== EVENTS =====================
DROP TABLE IF EXISTS events;
CREATE TABLE events (
    event_id      INT AUTO_INCREMENT PRIMARY KEY,
    name          VARCHAR(150) NOT NULL,
    category      VARCHAR(50) NOT NULL,
    location      VARCHAR(150) NOT NULL,
    volunteers    INT DEFAULT 0 CHECK (volunteers <= 100),
    event_date    DATE NOT NULL,
    start_time    TIME NOT NULL,
    end_time      TIME NOT NULL,
    description   TEXT,
    status        VARCHAR(20) NOT NULL DEFAULT 'PENDING',

    CONSTRAINT uq_event_name UNIQUE (name)
);

-- ===================== VOLUNTEER PARTICIPATIONS =====================
DROP TABLE IF EXISTS volunteer_participations;
CREATE TABLE volunteer_participations (
    volunteer_id   INT NOT NULL,
    volunteer_name VARCHAR(100) NOT NULL,
    event_name     VARCHAR(150) NOT NULL,
    event_date     DATE NOT NULL,
    role           VARCHAR(100),
    check_in       DATETIME,
    check_out      DATETIME,
    hours          DOUBLE,
    status         ENUM('PRESENT','ABSENT','CANCELED','UNSET') NOT NULL,

    CONSTRAINT fk_vp_volunteer
        FOREIGN KEY (volunteer_id)
        REFERENCES volunteers(volunteer_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,

    CONSTRAINT fk_vp_event
        FOREIGN KEY (event_name)
        REFERENCES events(name)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

-- ===================== CERTIFICATES =====================
DROP TABLE IF EXISTS certificates;
CREATE TABLE certificates (
    certificate_id INT AUTO_INCREMENT PRIMARY KEY,
    volunteer_id   INT NOT NULL,
    event_name     VARCHAR(150) NOT NULL,
    issue_date     DATE NOT NULL,
    hours_earned   DOUBLE NOT NULL,

    CONSTRAINT fk_cert_volunteer
        FOREIGN KEY (volunteer_id)
        REFERENCES volunteers(volunteer_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,

    CONSTRAINT fk_cert_event
        FOREIGN KEY (event_name)
        REFERENCES events(name)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

-- ===================== REPORTS =====================
DROP TABLE IF EXISTS reports;
CREATE TABLE reports (
    report_id      INT AUTO_INCREMENT PRIMARY KEY,
    report_type    VARCHAR(50) NOT NULL,
    report_title   VARCHAR(200) NOT NULL,
    date_generated DATETIME NOT NULL,
    generated_by   INT NOT NULL,
    CONSTRAINT fk_reports_admin
        FOREIGN KEY (generated_by)
        REFERENCES admins(admin_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);






